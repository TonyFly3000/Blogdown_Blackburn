[
["visualize.html", "Chapter 4 Visualize 4.1 ggplot2 4.2 plotly 4.3 leaflet", " Chapter 4 Visualize People say a picture is worth a thousand words.In this chapter,will share how to create data chart in ggplot ,create interact chart in ploly and create map in leaflet. 4.1 ggplot2 4.1.1 scatter plot pop_m vs year scatter plot:from 1950 to 2007,Asia 1B to 4B by continent with color library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,color=continent)) + geom_point() gg by continent with size[not advised] library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,size=continent)) + geom_point() gg by continent with shape library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,shape=continent)) + geom_point() gg pop_m vs year scatter plot:from 1950 to 2007, world pop increased from 2B to 6B Set point to fixed value,for example colour = “red” and size = 3 library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m)) + geom_point(colour = &quot;red&quot;, size = 3) gg 4.1.2 line plot pop_m vs year line plot:from 1950 to 2007, world pop increased from 2B to 6B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m)) + geom_line()+geom_point() gg by continent with color library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,color=continent)) + geom_line() gg Add one more line with another variable library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE),pop_m_haft=sum(pop/1000000,na.rm = TRUE)/2) gg=ggplot(gapminder2, aes(x = year, y = pop_m)) + geom_line()+geom_point()+geom_line(data=gapminder2,aes(x = year, y = pop_m_haft)) gg 4.1.3 bar plot pop_m vs continent bar plot:At 2007, Asia have most pop 3.8B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%group_by(continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = continent,y=pop_m)) + geom_col() gg 4.1.4 Dot plot pop_m vs continent bar plot:At 2007, Asia have most pop 3.8B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%group_by(continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE),pop_m_half=sum(pop/1000000,na.rm = TRUE)/2) gg=ggplot(gapminder2, aes(x = pop_m, y = continent)) + geom_point() gg 4.1.5 histogram pop_m histogram:At 2007, most of the countries under 500M pop,two countries over 1000M pop. library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%mutate(pop_m=pop/1000000) gg=ggplot(gapminder2, aes(x = pop_m)) +geom_histogram() gg 4.1.6 Boxplot pop_m Boxplot:At 2007, most of the countries under 500M pop,two countries over 1000M pop. library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%mutate(pop_m=pop/1000000) gg=ggplot(gapminder2, aes(x =1, y=pop_m)) +geom_boxplot() gg ### Waterfall chart library(gapminder) library(dplyr) library(ggplot2) # make flag gapminder2=gapminder%&gt;%filter(year==2007 | year==2002)%&gt;%mutate(pop_m=pop/1000000)%&gt;%mutate(aisa_flag=ifelse(continent==&#39;Asia&#39;,&#39;Asia&#39;,&#39;non-Asia&#39;) ,china_flag=ifelse(country==&#39;China&#39;,&#39;China&#39;,&#39;non-China&#39;) ) # make 2007 , 2002 gapminder4=gapminder2%&gt;%group_by(year)%&gt;%summarize(pop_m=sum(pop_m))%&gt;% mutate(var=year)%&gt;%select(var,pop_m)%&gt;%mutate(id=row_number()) gapminder4=gapminder4%&gt;%filter(id==1)%&gt;%select(var,pop_m) # make asis, non-aisa gapminder5=gapminder2%&gt;%group_by(year,aisa_flag)%&gt;%summarize(pop_m=sum(pop_m))%&gt;%ungroup()%&gt;% mutate(var=aisa_flag)%&gt;%mutate(id=row_number()) gapminder5=gapminder5%&gt;%filter(id==4)%&gt;%select(var,pop_m) # make china , non-china gapminder6=gapminder2%&gt;%group_by(year,aisa_flag,china_flag)%&gt;%summarize(pop_m=sum(pop_m))%&gt;%ungroup()%&gt;% mutate(var=china_flag)%&gt;%mutate(id=row_number()) gapminder6=gapminder6%&gt;%filter(id==4 | id==5 )%&gt;%select(var,pop_m) # combine all gapminder_all=rbind(gapminder4,gapminder5,gapminder6) gapminder_all$ord &lt;- c(1,2,4,3) gapminder_all=gapminder_all%&gt;%arrange(ord) gapminder_all$time &lt;- seq_along(gapminder_all$pop_m) gapminder_all$balance &lt;- cumsum(c(0, gapminder_all$pop_m[-nrow(gapminder_all)])) gg=ggplot(gapminder_all) + geom_rect(aes(x=var,xmin = time - 0.45, xmax = time + 0.45, ymin = balance, ymax = balance + pop_m))+ scale_x_discrete(labels=c(&#39;2002&#39;= &quot;2002&quot;, &#39;China&#39; = &quot;2007 Non Asia&quot;, &#39;non-Asia&#39; = &quot;2007 Non china&quot;, &#39;non-China&#39; = &quot;2007 China&quot;) ) gg 4.1.7 Heatmap library(reshape2) mydata &lt;- mtcars[, c(1,3,4,5,6,7)] cormat &lt;- round(cor(mydata),2) melted_cormat &lt;- melt(cormat) head(melted_cormat) ## Var1 Var2 value ## 1 mpg mpg 1.00 ## 2 disp mpg -0.85 ## 3 hp mpg -0.78 ## 4 drat mpg 0.68 ## 5 wt mpg -0.87 ## 6 qsec mpg 0.42 library(ggplot2) gg=ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + geom_tile() gg 4.1.8 Moving chart #library(devtools) #devtools::install_github(&#39;thomasp85/gganimate&#39;) library(ggplot2) library(gganimate) library(gifski) # For example, suppose we wanted to create an animation similar to the Gapminder # world animation, using Jenny Bryan&#39;s gapminder package for the data. library(gapminder) ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, colour = country)) + geom_point(alpha = 0.7, show.legend = FALSE) + scale_colour_manual(values = country_colors) + scale_size(range = c(2, 12)) + scale_x_log10() + facet_wrap(~continent) + # Here comes the gganimate specific bits labs(title = &#39;Year: {frame_time}&#39;, x = &#39;GDP per capita&#39;, y = &#39;life expectancy&#39;) + transition_time(year) + ease_aes(&#39;linear&#39;) #save into gif file #anim_save(&#39;gg.gif&#39;) 4.1.9 Other plot 4.1.10 make multi chart by variable: library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m)) + geom_line()+geom_point()+facet_grid(vars(continent)) gg 4.1.11 setting: title,subtitle,x label,y label pop_m vs year line plot:from 1950 to 2007, world pop increased from 2B to 6B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m)) + geom_line()+geom_point() gg+ labs(title = &quot;A title&quot;, subtitle = &quot;A subtitle&quot;,x=&quot;New x label&quot;,y=&quot;New y label&quot;) 4.1.12 themes For more themes go to https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html theme_fivethirtyeight: library(gapminder) library(dplyr) library(ggplot2) library(ggthemes) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,color=continent)) + geom_point() gg+ labs(title = &quot;A title&quot;, subtitle = &quot;A subtitle&quot;,x=&quot;New x label&quot;,y=&quot;New y label&quot;)+theme_fivethirtyeight() theme_economist(): library(gapminder) library(dplyr) library(ggplot2) library(ggthemes) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,color=continent)) + geom_point() gg+ labs(title = &quot;A title&quot;, subtitle = &quot;A subtitle&quot;,x=&quot;New x label&quot;,y=&quot;New y label&quot;)+theme_economist() 4.2 plotly 4.2.1 scatter plot pop_m vs year scatter plot:from 1950 to 2007, world pop increased from 2B to 6B by continent with color library(plotly) library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(data = gapminder2, x = ~year, y = ~pop_m,color=~continent) p by pop_m with size library(plotly) library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(data = gapminder2, x = ~year, y = ~pop_m,size=~pop_m) p by pop_m with symbol library(plotly) library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(data = gapminder2, x = ~year, y = ~pop_m,symbol=~continent) p 4.2.2 line plot pop_m vs year line plot:from 1950 to 2007, world pop increased from 2B to 6B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(gapminder2, x = ~year, y = ~pop_m, type = &#39;scatter&#39;, mode = &#39;lines+markers&#39;) p by continent with color library(plotly) library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(data = ungroup(gapminder2), x = ~year, y = ~pop_m,color=~continent,type = &#39;scatter&#39;, mode = &#39;lines+markers&#39;) p Add one more line with another variable library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE),pop_m_haft=sum(pop/1000000,na.rm = TRUE)/2) p &lt;- plot_ly(gapminder2, x = ~year, y = ~pop_m, name = &#39;pop_m&#39;,type = &#39;scatter&#39;, mode = &#39;lines+markers&#39;)%&gt;%add_trace(x = ~year, y = ~pop_m_haft, name = &#39;pop_m_haft&#39;, mode = &#39;lines+markers&#39;) p 4.2.3 bar plot pop_m vs continent bar plot:At 2007, Asia have most pop 3.8B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%group_by(continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(gapminder2, x = ~continent, y = ~pop_m, type = &#39;bar&#39;,text = ~pop_m, textposition = &#39;auto&#39;) p pop_m vs year by continent stacked bar chart library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(continent,year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(gapminder2, x = ~year, y = ~pop_m, type = &#39;bar&#39;,color = ~continent)%&gt;%layout( barmode = &#39;stack&#39;) p 4.2.4 Dot plot pop_m vs continent bar plot:At 2007, Asia have most pop 3.8B library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%group_by(continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE),pop_m_half=sum(pop/1000000,na.rm = TRUE)/2) p &lt;- plot_ly(gapminder2, x = ~pop_m, y = ~continent, name = &quot;pop_m&quot;, type = &#39;scatter&#39;, mode = &quot;markers&quot;, marker = list(color = &quot;pink&quot;)) %&gt;% add_trace(x = ~pop_m_half, y = ~continent, name = &quot;pop_m_half&quot;,type = &#39;scatter&#39;, mode = &quot;markers&quot;, marker = list(color = &quot;blue&quot;)) p 4.2.5 Histogram pop_m histogram:At 2007, most of the countries under 500M pop,two countries over 1000M pop. library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%filter(year==2007)%&gt;%mutate(pop_m=pop/1000000) p &lt;- plot_ly(data=gapminder2,x = ~pop_m, type = &quot;histogram&quot;) p 4.2.6 Boxplot pop_m Boxplot:At 2007, most of the countries under 500M pop,two countries over 1000M pop. library(gapminder) library(dplyr) library(ggplot2) p &lt;- plot_ly(data=gapminder2,y = ~pop_m, type = &quot;box&quot;) p 4.2.7 Heatmap library(reshape2) mydata &lt;- mtcars[, c(1,3,4,5,6,7)] cormat &lt;- round(cor(mydata),2) melted_cormat &lt;- melt(cormat) head(melted_cormat) ## Var1 Var2 value ## 1 mpg mpg 1.00 ## 2 disp mpg -0.85 ## 3 hp mpg -0.78 ## 4 drat mpg 0.68 ## 5 wt mpg -0.87 ## 6 qsec mpg 0.42 library(plotly) p=plot_ly(data = melted_cormat , x=~ Var1,y=~ Var2, z=~value, type = &quot;heatmap&quot;) p 4.2.8 Map library(plotly) df &lt;- read.csv(&quot;https://raw.githubusercontent.com/plotly/datasets/master/2011_us_ag_exports.csv&quot;) df$hover &lt;- with(df, paste(state, &#39;&lt;br&gt;&#39;, &quot;Beef&quot;, beef, &quot;Dairy&quot;, dairy, &quot;&lt;br&gt;&quot;, &quot;Fruits&quot;, total.fruits, &quot;Veggies&quot;, total.veggies, &quot;&lt;br&gt;&quot;, &quot;Wheat&quot;, wheat, &quot;Corn&quot;, corn)) # give state boundaries a white border l &lt;- list(color = toRGB(&quot;white&quot;), width = 2) # specify some map projection/options g &lt;- list( scope = &#39;usa&#39;, projection = list(type = &#39;albers usa&#39;), showlakes = TRUE, lakecolor = toRGB(&#39;white&#39;) ) p &lt;- plot_geo(df, locationmode = &#39;USA-states&#39;) %&gt;% add_trace( z = ~total.exports, text = ~hover, locations = ~code, color = ~total.exports, colors = &#39;Purples&#39; ) %&gt;% colorbar(title = &quot;Millions USD&quot;) %&gt;% layout( title = &#39;2011 US Agriculture Exports by State&lt;br&gt;(Hover for breakdown)&#39;, geo = g ) p 4.2.9 Moving chart library(plotly) library(gapminder) p &lt;- gapminder %&gt;% plot_ly( x = ~gdpPercap, y = ~lifeExp, size = ~pop, color = ~continent, frame = ~year, text = ~country, hoverinfo = &quot;text&quot;, type = &#39;scatter&#39;, mode = &#39;markers&#39; ) %&gt;% layout( xaxis = list( type = &quot;log&quot; ) ) p ### Other plot 3D plot: library(plotly) mtcars$am[which(mtcars$am == 0)] &lt;- &#39;Automatic&#39; mtcars$am[which(mtcars$am == 1)] &lt;- &#39;Manual&#39; mtcars$am &lt;- as.factor(mtcars$am) p &lt;- plot_ly(mtcars, x = ~wt, y = ~hp, z = ~qsec, color = ~am, colors = c(&#39;#BF382A&#39;, &#39;#0C4B8E&#39;)) %&gt;% add_markers() %&gt;% layout(scene = list(xaxis = list(title = &#39;Weight&#39;), yaxis = list(title = &#39;Gross horsepower&#39;), zaxis = list(title = &#39;1/4 mile time&#39;))) p 4.2.10 setting:title,subtitle,x label,y label pop_m vs year line plot:from 1950 to 2007, world pop increased from 2B to 6B library(gapminder) library(dplyr) library(plotly) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(gapminder2, x = ~year, y = ~pop_m, type = &#39;scatter&#39;, mode = &#39;lines+markers&#39;) p%&gt;%layout(title = &#39;title&#39; ,xaxis = list(title = &#39;x lable&#39;) ,yaxis = list(title = &#39;y lable&#39;) ) 4.2.11 hover text library(gapminder) library(dplyr) library(ggplot2) gapminder2=gapminder%&gt;%group_by(year)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) p &lt;- plot_ly(gapminder2, x = ~year, y = ~pop_m, type = &#39;scatter&#39;, mode =&#39;lines+markers&#39;, hoverinfo = &#39;text&#39;,text = ~paste(&#39;year is: &#39;, year,&#39;populate is: &#39;,pop_m)) p 4.2.12 convert ggplot to plotly library(gapminder) library(dplyr) library(ggplot2) library(ggthemes) gapminder2=gapminder%&gt;%group_by(year,continent)%&gt;%summarise(pop_m=sum(pop/1000000,na.rm = TRUE)) gg=ggplot(gapminder2, aes(x = year, y = pop_m,color=continent)) + geom_point()+ labs(title = &quot;A title&quot;, subtitle = &quot;A subtitle&quot;,x=&quot;New x label&quot;,y=&quot;New y label&quot;)+theme_fivethirtyeight() p=ggplotly(gg) p 4.3 leaflet leaflet is a javascript library for interactive map for more go to : https://leafletjs.com/ World map: library(leaflet) leaflet() %&gt;%addTiles() library(leaflet) library(ggmap) location=geocode( &quot;Raffles City Shanghai&quot; ) #121.4765 ,31.23204 location$lon=121.4720 location$lat=31.2345 m &lt;- leaflet()%&gt;% addTiles() %&gt;% # Add default OpenStreetMap map tiles setView(lng=location$lon, lat=location$lat, zoom = 15) %&gt;% addMarkers(lng=location$lon, lat=location$lat, popup=&quot;ebay shanghai&quot;) m "]
]
